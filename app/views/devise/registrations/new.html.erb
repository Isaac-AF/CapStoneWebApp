<div class="container mt-3">
  <h2 class="mb-4 text-center">Create a new Account</h2>

  <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { class: "needs-validation", novalidate: true, id: "signupForm" }) do |f| %>
    <%= devise_error_messages! %>

    <div class="mb-3">
      <%= f.label :name, "First Name", class: "form-label fw-bold" %>
      <%= f.text_field :name, class: "form-control" %>
    </div>

    <div class="mb-3">
      <%= f.label :email, class: "form-label fw-bold" %>
      <%= f.email_field :email, autofocus: true, autocomplete: "email", class: "form-control" %>
    </div>

    <div class="mb-3">
      <%= f.label :password, class: "form-label fw-bold" %>
      <%= f.password_field :password, autocomplete: "new-password", class: "form-control" %>
    </div>

    <div class="mb-3">
      <%= f.label :password_confirmation, class: "form-label fw-bold" %>
      <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "form-control" %>
    </div>

    <div class="mb-3">
      <%= f.label :birthday, "Birthdate", class: "form-label fw-bold" %>
      <%= f.text_field :birthday, class: "form-control", placeholder: "MM/DD/YYYY", inputmode: "numeric", pattern: "\\d{2}/\\d{2}/\\d{4}" %>
    </div>

    <div class="mb-3">
      <%= f.label :sex, "Sex", class: "form-label fw-bold" %>
      <%= f.select :sex, ["Male", "Female", "Non-Binary", "Other"], { include_blank: true }, class: "form-select" %>
    </div>

    <div class="mb-3">
      <%= f.label :height, "Height", class: "form-label fw-bold" %>
      <%= f.select :height, (54..78).map { |inches| [height_label(inches), inches] }, { include_blank: true }, class: "form-select" %>
    </div>

    <div class="mb-3">
      <%= f.label :weight, "Weight (lbs)", class: "form-label fw-bold" %>
      <%= f.number_field :weight, class: "form-control" %>
    </div>

    <div class="mb-3">
      <%= f.label :activity_level, "Activity Level", class: "form-label fw-bold" %>
      <%= f.select :activity_level, [
          ["Sedentary - Little or no exercise; desk job, minimal movement during the day", "Sedentary"],
          ["Light - Exercise 1–3 days/week OR a job that involves some walking or standing like a teacher or retail", "Light"],
          ["Moderate - Exercise 3–5 days/week OR active job with some lifting/walking like a server or mail carrier", "Moderate"],
          ["Active - Exercise 6–7 days/week OR a physically demanding job like construction or a full-time athlete", "Active"]
        ],
        { include_blank: true },
        class: "form-select" %>
    </div>

    <fieldset class="mb-4 border rounded p-3">
      <h3>Set Your Top 3 Goals</h3>

      <div class="mb-3">
        <%= f.label :primary_goal, "Primary Goal", class: "form-label fw-bold" %>
        <%= f.select :primary_goal, goal_options, { include_blank: true }, { id: "primary_goal", class: "form-select" } %>
      </div>

      <div class="mb-3">
        <%= f.label :secondary_goal, "Secondary Goal (Optional)", class: "form-label fw-bold" %>
        <%= f.select :secondary_goal, goal_options, { include_blank: true }, { id: "secondary_goal", class: "form-select" } %>
      </div>

      <div class="mb-3">
        <%= f.label :tertiary_goal, "Tertiary Goal (Optional)", class: "form-label fw-bold" %>
        <%= f.select :tertiary_goal, goal_options, { include_blank: true }, { id: "tertiary_goal", class: "form-select" } %>
      </div>
    </fieldset>

    <div class="mb-4">
      <%= f.label :dietary_restrictions, "Dietary Restrictions (Optional)", class: "form-label fw-bold" %>
      <%= f.text_field :dietary_restrictions, class: "form-control" %>
    </div>

    <div class="d-grid">
      <button id="SignupBtn" type="submit" class="btn btn-primary btn-lg d-flex justify-content-center align-items-center gap-2">
        <span id="SignupBtnText">Sign up</span>
        <span id="SignupBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
      </button>
    </div>
  <% end %>
</div>

<div class="mb-5"></div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const signupForm = document.getElementById("signupForm");

    if (signupForm) {
      signupForm.addEventListener("submit", function () {
        const button = document.getElementById("SignupBtn");
        button.disabled = true;
        document.getElementById("SignupBtnText").textContent = "Signing up...";
        document.getElementById("SignupBtnSpinner").classList.remove("d-none");
      });
    }
  });
</script>
